---
language: python
if: type IN (pull_request) OR branch IN (main, develop)
python:
  - "3.6"
  - "3.7"
  - "3.8"

install:
  # XXX: Migrate this to Poetry fully
  - "pip install virtualenv"
  - "virtualenv ./venv"
  - "python -m pip install -U pip"
  - "pip install tox"

jobs:
  include:
    - stage: "lint"
      name: "Linting Tests"
      script: ".venv/bin/tox -e black"
    - script: ".venv/bin/tox -e flake8"
    - script: ".venv/bin/tox -e bandit"
    - script: ".venv/bin/tox -e pydocstyle"
    - stage: "test"
      name: "Unit Tests"
      script: ".venv/bin/tox -e py46,py37,py38"
    - stage: "coveralls"
      name: "Coveralls"
      script: ".venv/bin/tox -e coveralls"

stages:
  - "lint"
  - "test"
  - "coveralls"
